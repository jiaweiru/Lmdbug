# 🔍 Lmdbug 使用指南

> **Lmdbug** - 强大的 LMDB 数据库预览工具，支持 Protobuf 数据解析与可视化

---

## 🎨 UI 设计概述

Lmdbug 的 Web 界面基于 Gradio 框架构建，采用直观的双栏布局设计，为 LMDB 数据库浏览和 Protobuf 数据解析提供用户友好的交互体验。

### 📐 整体布局

```
┌─────────────────┬─────────────────────────────┐
│   🔧 配置区域     │    📊 数据浏览区域          │
│   (1/3 宽度)     │    (2/3 宽度)               │
│                  │                             │
│ • 数据库配置      │ • 数据预览标签页            │
│ • Protobuf配置   │ • 搜索功能标签页            │
│ • 状态信息        │ • 结果显示区域              │
│                 │                             │
└─────────────────┴─────────────────────────────┘
│            📈 全局状态栏                      │
└────────────────────────────────────────────── ───┘
```

---

## 🧩 UI 组件详解

### 🔧 左侧配置区域

#### 1. 📁 数据库配置
- **📂 数据库路径输入框**：指定 LMDB 数据库目录路径
- **🚀 加载数据库按钮**：主要操作按钮，触发数据库加载

#### 2. 🔌 Protobuf 配置（可选）
- **📄 Protobuf 模块路径**：编译后的 `.pb2.py` 文件路径
- **🏷️ 消息类名称**：Protobuf 消息类名（如 `User`, `Product` 等）
- **📋 消息类型下拉框**：动态生成，用于选择主要解析类型

#### 3. 📊 数据库信息显示
- **📈 JSON 格式显示**：显示数据库统计信息、环境信息等

### 📊 右侧数据浏览区域

#### 🗂️ Browse 标签页
- **🔍 预览前 N 条记录**：
  - 数量输入框（1-1000）
  - "Preview First Entries" 按钮

- **📑 按索引范围浏览**：
  - 起始索引输入框
  - 记录数量输入框  
  - "Browse by Index" 按钮

#### 🔎 Key Search 标签页
- **🎯 精确键搜索**：
  - 键值输入框
  - "Search Exact Key" 按钮

- **🔤 前缀搜索**：
  - 前缀输入框
  - 最大结果数限制（1-1000）
  - "Search by Prefix" 按钮

- **🔍 模式搜索**：
  - 模式输入框（子字符串匹配）
  - 最大结果数限制
  - "Search by Pattern" 按钮

#### 📋 结果显示区域
- **📄 JSON 格式结果**：结构化显示查询结果，包括：
  - 键值信息（UTF-8 和十六进制格式）
  - 值大小
  - Protobuf 解析结果（如可用）

### 📈 底部状态栏
- **⚡ 实时状态更新**：显示操作结果、错误信息、成功提示等

---

## 📘 使用文档

### 🚀 基本使用流程

#### 1. 🎬 启动应用

```bash
# 🏁 命令行启动
lmdbug

# 📂 或指定数据库路径
lmdbug /path/to/your/database

# 🔌 带 Protobuf 支持
lmdbug /path/to/database --protobuf-module user_pb2.py --message-class User
```

#### 2. ⚙️ 配置数据库
1. 在 **"LMDB Database Path"** 输入框中输入数据库路径
2. 点击 **"Load Database"** 按钮
3. 检查状态栏确认加载成功 ✅

#### 3. 🔌 配置 Protobuf（可选）
1. 在 **"Protobuf Module Path"** 输入编译后的 `.pb2.py` 文件路径
2. 在 **"Message Class Name"** 输入消息类名
3. 重新点击 **"Load Database"** 加载 Protobuf 配置
4. 在下拉框中选择主要消息类型

---

### 🔍 数据浏览操作

#### 📖 Browse 功能
- **📊 预览数据**：设置条目数量（默认10），点击 "Preview First Entries"
- **📑 索引浏览**：设置起始索引和数量，点击 "Browse by Index"

#### 🔎 Key Search 功能  
- **🎯 精确搜索**：输入完整键名，点击 "Search Exact Key"
- **🔤 前缀搜索**：输入键前缀，设置结果限制，点击 "Search by Prefix"
- **🔍 模式搜索**：输入子字符串，设置结果限制，点击 "Search by Pattern"

---

### 📖 结果解读

#### 📋 基本字段结构

```json
{
  "key": "user:1001",                    // 🔑 UTF-8 解码的键（失败时显示十六进制）
  "key_raw": "757365723a31303031",       // 🔢 原始十六进制键值
  "value_size": 156,                     // 📏 值的字节大小
  "value_info": {                        // 📦 值的详细信息
    "raw_hex": "0a04...",                // 🔢 原始十六进制数据
    "size": 156,                         // 📏 字节大小
    "protobuf": {                        // 🔌 Protobuf 解析结果（如可用）
      "success": true,                   // ✅ 解析成功标志
      "json": "{...}",                   // 📄 JSON 格式
      "dict": {...}                      // 📚 字典格式
    },
    "message_type_used": "User"          // 🏷️ 使用的消息类型
  }
}
```

#### ⚠️ 错误处理
- **🚫 数据库错误**：路径不存在、权限问题等
- **🔌 Protobuf 错误**：模块不存在、类名错误、解析失败等
- **🔍 搜索错误**：键不存在、输入为空等

---

### 🚀 高级功能

#### 🔄 多消息类型支持
- ✅ 加载包含多个消息类的 Protobuf 模块
- 🔄 通过下拉框切换主要解析类型
- 🎯 系统自动使用指定类型解析所有值

#### 📊 数据格式兼容
- **📝 UTF-8 键**：直接显示可读文本
- **🔢 二进制键**：显示十六进制表示
- **🔄 混合数据**：自动处理不同编码格式

---

### ⚡ 性能优化建议

#### 🗄️ 大数据库浏览
- ✅ 使用索引范围浏览而非全量预览
- 🎯 限制搜索结果数量（建议 ≤ 100）
- 🚀 优先使用前缀搜索而非模式搜索

#### 🔌 Protobuf 配置
- ✅ 确保 `.pb2.py` 文件正确编译
- 🎯 使用准确的消息类名
- 🛠️ 处理解析失败时的降级显示

---

### 🔧 故障排查

#### ❓ 常见问题

##### 1. 🚫 数据库加载失败
- 🔍 检查路径是否正确
- 🔐 确认数据库文件权限
- ✅ 验证 LMDB 格式完整性

##### 2. ⚠️ Protobuf 解析失败
- 📄 验证模块路径和类名
- 🔍 检查数据是否为对应格式
- 📊 查看状态栏错误信息

##### 3. 🔍 搜索无结果
- ✅ 确认键值存在
- 🔤 检查编码格式（UTF-8 vs 二进制）
- 🔢 尝试使用十六进制格式搜索

---

## 🎉 总结

这个 Web UI 设计简洁直观，支持快速数据库浏览和调试，特别适合开发和运维场景下的 LMDB 数据分析需求。通过友好的界面和强大的功能，让 LMDB 数据库的管理和调试变得轻松高效！

---

> 💡 **提示**：如遇到问题，请查看状态栏的实时反馈信息，或参考故障排查部分。祝您使用愉快！ 🚀